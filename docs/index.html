<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ull-esit-inf-dsi-21-22-prct10-async-fs-process-ccolivares</title><meta name="description" content="Documentation for ull-esit-inf-dsi-21-22-prct10-async-fs-process-ccolivares"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">ull-esit-inf-dsi-21-22-prct10-async-fs-process-ccolivares</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1> ull-esit-inf-dsi-21-22-prct10-async-fs-process-ccolivares </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography"><p><a href="https://coveralls.io/github/ULL-ESIT-INF-DSI-2122/ull-esit-inf-dsi-21-22-prct10-async-fs-process-ccolivares?branch=main"><img src="https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2122/ull-esit-inf-dsi-21-22-prct10-async-fs-process-ccolivares/badge.svg?branch=main" alt="Coverage Status"></a>
<a href="https://sonarcloud.io/summary/new_code?id=ULL-ESIT-INF-DSI-2122_ull-esit-inf-dsi-21-22-prct10-async-fs-process-ccolivares"><img src="https://sonarcloud.io/api/project_badges/measure?project=ULL-ESIT-INF-DSI-2122_ull-esit-inf-dsi-21-22-prct10-async-fs-process-ccolivares&metric=alert_status" alt="Quality Gate Status"></a></p>
<p><a href="https://ull-esit-inf-dsi-2122.github.io/ull-esit-inf-dsi-21-22-prct10-async-fs-process-ccolivares/">INFORME EN GITHUB PAGES</a></p>

<a href="#práctica-10-sistema-de-ficheros-y-creación-de-procesos-en-nodejs" id="práctica-10-sistema-de-ficheros-y-creación-de-procesos-en-nodejs" style="color: inherit; text-decoration: none;">
  <h1>Práctica 10. Sistema de ficheros y creación de procesos en Node.js</h1>
</a>

<a href="#introducción" id="introducción" style="color: inherit; text-decoration: none;">
  <h2>Introducción</h2>
</a>
<p>En esta práctica trabajaremos con las API&#39;s proporcionadas por Node.js, familiarizandonos con ellas y practicando sus distintos usos, entre ellos interactuar con el sistema de ficheros y crear procesos. </p>

<a href="#desarrollo-de-los-ejercicios" id="desarrollo-de-los-ejercicios" style="color: inherit; text-decoration: none;">
  <h2>Desarrollo de los ejercicios</h2>
</a>

<a href="#ejercicio-1-traza-de-un-código-asíncrono" id="ejercicio-1-traza-de-un-código-asíncrono" style="color: inherit; text-decoration: none;">
  <h3>Ejercicio 1: Traza de un código asíncrono</h3>
</a>
<p><a href="https://github.com/ULL-ESIT-INF-DSI-2122/ull-esit-inf-dsi-21-22-prct10-async-fs-process-ccolivares/blob/main/src/ejercicio-1.ts">--&gt; Acceso al código de ejemplo en Github</a></p>
<p>Este ejercicio consiste en analizar un código de Typescript que hace uso del módulo <code>fs</code> de <code>Node.js</code>. Se nos pide hacer una traza con el estado en cada momento de la pila de llamadas, el registro de eventos de la API, la cola de manejadores y la salida por consola. El código analizado será el siguiente:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">access</span><span class="hl-1">, </span><span class="hl-2">constants</span><span class="hl-1">, </span><span class="hl-2">watch</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;fs&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> !== </span><span class="hl-4">3</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;Please, specify a file&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">filename</span><span class="hl-1"> = </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-4">2</span><span class="hl-1">];</span><br/><br/><span class="hl-1">  </span><span class="hl-5">access</span><span class="hl-1">(</span><span class="hl-2">filename</span><span class="hl-1">, </span><span class="hl-2">constants</span><span class="hl-1">.</span><span class="hl-7">F_OK</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`File </span><span class="hl-6">${</span><span class="hl-2">filename</span><span class="hl-6">}</span><span class="hl-3"> does not exist`</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Starting to watch file </span><span class="hl-6">${</span><span class="hl-2">filename</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">watcher</span><span class="hl-1"> = </span><span class="hl-5">watch</span><span class="hl-1">(</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">argv</span><span class="hl-1">[</span><span class="hl-4">2</span><span class="hl-1">]);</span><br/><br/><span class="hl-1">      </span><span class="hl-2">watcher</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;change&#39;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`File </span><span class="hl-6">${</span><span class="hl-2">filename</span><span class="hl-6">}</span><span class="hl-3"> has been modified somehow`</span><span class="hl-1">);</span><br/><span class="hl-1">      });</span><br/><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`File </span><span class="hl-6">${</span><span class="hl-2">filename</span><span class="hl-6">}</span><span class="hl-3"> is no longer watched`</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Procedemos como se nos pide a analizar la traza del programa: </p>
<ul>
<li>Instante 0: Inicialización</li>
</ul>
<p>| <strong>PILA DE LLAMADAS</strong> 	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:--------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
|           -          	|            -            	|            -            	|            -           	|
<br></p>
<ul>
<li>Instante 1: se introduce el proceso <code>access</code> a la pila de llamadas</li>
</ul>
<p>| <strong>PILA DE LLAMADAS</strong> 	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:--------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
|        ACCESS        	|            -            	|            -            	|            -           	|
<br></p>
<ul>
<li>Instante 2: <code>access</code> sale de la pila de llamada y su callback pasa al registro de eventos.</li>
</ul>
<p>| <strong>PILA DE LLAMADAS</strong> 	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:--------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
|           -          	|          ACCESS          	|            -            	|            -           	|
<br></p>
<ul>
<li>Instante 3: el callback de <code>access</code> pasa a la cola de manejadores.</li>
</ul>
<p>| <strong>PILA DE LLAMADAS</strong> 	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:--------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
|           -          	|            -            	|        	 ACCESS         	|            -           	|
<br></p>
<ul>
<li>Instante 4: el callback de <code>access</code> pasa a la pila de llamadas y comienza a ejecutarse.</li>
</ul>
<p>|     <strong>PILA DE LLAMADAS</strong>     	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:----------------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
|       EJECUTANDO ACCESS     	|            -            	|            -            	|            -           	|
<br></p>
<ul>
<li>Instante 5: al empezar a ejecutarse si no hay ningun fallo se ejecutará la instruccion  <code>console.log(`Starting to watch file ${filename}`)</code>.</li>
</ul>
<p>|               <strong>PILA DE LLAMADAS</strong>               	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:------------------------------------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
| <code>console.log(`Starting to watch ${filename}`)</code> 	|            -            	|            -            	|            -           	|
<br></p>
<ul>
<li>Instante 6: se ejecuta la instrucción que mencionamos, sale de la pila de llamadas y en la salida por consola se muestra el mensaje correspondiente .</li>
</ul>
<p>|     <strong>PILA DE LLAMADAS</strong>     	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	|      <strong>SALIDA POR CONSOLA</strong>      	|
|:----------------------------:	|:-----------------------:	|:-----------------------:	|:--------------------------------:	|
|              -                |            -            	|            -            	| Starting to watch helloworld.txt 	|
<br></p>
<ul>
<li>Instante 7: la siguiente instrucción que vemos es la función <code>watch()</code> que observa los cambios en el fichero que le pasemos por parámetro. Se incluye en la pila de llamadas.</li>
</ul>
<p>|     <strong>PILA DE LLAMADAS</strong>     	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:----------------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
|           <code>watch()</code>          	|            -            	|            -            	|            -           	|
<br></p>
<ul>
<li>Instante 8: la función <code>watch()</code> se ejecuta y sale de la pila de llamadas</li>
</ul>
<p>| <strong>PILA DE LLAMADAS</strong> 	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:--------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
|           -          	|            -            	|            -            	|            -           	|
<br></p>
<ul>
<li>Instante 9: la siguiente instrucción que encontramos es <code>watcher.on(&#39;change&#39;)</code> por lo tanto se inserta en la pila de llamadas.</li>
</ul>
<p>|     <strong>PILA DE LLAMADAS</strong>     	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:----------------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
|    <code>watcher.on(&#39;change&#39;)</code>    	|            -            	|            -            	|            -           	|
<br></p>
<ul>
<li>Instante 10: este callback pasa al registro de eventos, esperando que haya un evento <code>change</code> se quedará en el registro de eventos.</li>
</ul>
<p>|     <strong>PILA DE LLAMADAS</strong>     	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:----------------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
|              -                |  <code>watcher.on(&#39;change&#39;)</code> 	|            -            	|            -           	|
<br></p>
<ul>
<li>Instante 11: la siguiente instrucción que encontramos es <code>console.log(`File ${filename} is no longer watched`)</code> que se añade a la pila de llamadas.</li>
</ul>
<p>|                   <strong>PILA DE LLAMADAS</strong>                   	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:--------------------------------------------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
| <code>console.log(`File ${filename} is no longer watched`)</code> 	|  <code>watcher.on(&#39;change&#39;)</code> 	|            -            	|            -           	|
<br></p>
<ul>
<li>Instante 12: la instrucción mencionada en el paso anterior se ejecuta y se muestra en la salida.</li>
</ul>
<p>|     <strong>PILA DE LLAMADAS</strong>     	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	|          <strong>SALIDA POR CONSOLA</strong>          	|
|:----------------------------:	|:-----------------------:	|:-----------------------:	|:----------------------------------------:	|
|              -                |  <code>watcher.on(&#39;change&#39;)</code> 	|            -            	| File helloworld.txt is no longer watched 	|
<br></p>
<ul>
<li>Instante 13: si modificasemos el archivo la instrucción <code>watcher.on(&#39;change&#39;)</code> pasaría a la cola de manejadores.</li>
</ul>
<p>|     <strong>PILA DE LLAMADAS</strong>     	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:----------------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
|              -                |                         	|  <code>watcher.on(&#39;change&#39;)</code> 	|            -           	|
<br></p>
<ul>
<li>Instante 14: la instrucción pasaría a la pila de llamadas ya que esta se encuentra vacía y procedería a ejecutarse.</li>
</ul>
<p>|  <strong>PILA DE LLAMADAS</strong>  	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:----------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
| <code>watcher.on(&#39;change&#39;)</code> 	|            -            	|            -            	|            -           	|
<br></p>
<ul>
<li>Instante 15: dentro de esta encontramos la siguiente instrucción <code>console.log(`File ${filename} has been modified somehow`)</code>, por lo tanto se introducirá en la pila de llamadas y se ejecutará.</li>
</ul>
<p>|                      <strong>PILA DE LLAMADAS</strong>                     	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:-------------------------------------------------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
| <code>console.log(`File ${filename} has been modified somehow`)</code> 	|            -            	|            -            	|            -           	|
|                     <code>watcher.on(&#39;change&#39;)</code>                    	|            -            	|            -            	|            -           	|
<br></p>
<ul>
<li>Instante 17: al ejecutarse mostrará el mensaje correspondiente por pantalla.</li>
</ul>
<p>|  <strong>PILA DE LLAMADAS</strong>  	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	|             <strong>SALIDA POR CONSOLA</strong>            	|
|:----------------------:	|:-----------------------:	|:-----------------------:	|:---------------------------------------------:	|
| <code>watcher.on(&#39;change&#39;)</code> 	|            -            	|            -            	| File helloworld.txt has been modified somehow 	|
<br></p>
<ul>
<li>Instante 18: al terminar de ejecutarse el <code>watcher.on(&#39;change&#39;)</code> volverá a su posición en el registro de eventos para seguir esperando por cambios en el archivo correspondiente.</li>
</ul>
<p>| <strong>PILA DE LLAMADAS</strong> 	| <strong>REGISTRO DE EVENTOS</strong> 	| <strong>COLA DE MANEJADORES</strong> 	| <strong>SALIDA POR CONSOLA</strong> 	|
|:--------------------:	|:-----------------------:	|:-----------------------:	|:----------------------:	|
|                      	|  <code>watcher.on(&#39;change&#39;)</code> 	|            -            	|            -           	|
<br></p>
<p>Se nos indica en el enunciado que hagamos la traza con minimo dos modificaciones del fichero, esta segunda modificación se realizaría repitiendo los pasos del 13 al 18 (partiendo de que el <code>watcher.on(&#39;change&#39;)</code> esta en el registro de eventos como acaba en el paso 18) y si se quisiera una tercera se repetirían los mismos pasos y así sucesivamente.</p>
<ul>
<li>¿Qué hace la función access? ¿Para qué sirve el objeto constants?</li>
</ul>
<p>La función <code>access</code> de Node.js es un método utilizado para comprobar los permisos de un archivo o directorio determinado. Los permisos que se van a comprobar pueden ser especificados como un parámetro usando las constantes de acceso a archivos (objeto <code>constants</code>) que son las que contienen las constantes mas utilizadas para operaciones de permisos.
<br></p>

<a href="#ejercicio-2-buscador-de-palabras-en-un-archivo" id="ejercicio-2-buscador-de-palabras-en-un-archivo" style="color: inherit; text-decoration: none;">
  <h3>Ejercicio 2: Buscador de palabras en un archivo</h3>
</a>
<p><a href="https://github.com/ULL-ESIT-INF-DSI-2122/ull-esit-inf-dsi-21-22-prct10-async-fs-process-ccolivares/blob/main/src/ejercicio-2.ts">--&gt; Acceso al ejercicio 2 en Github</a></p>
<p>En este ejercicio se nos pide realizar un programa que devuelva el número de ocurrencias de una palabra en un fichero. Utilizaremos dos estrategias para realizar este programa, la primera será el uso del método <code>pipe</code> de un Stream, además del uso de los comandos <code>cat</code> y <code>grep</code> de Unix/Linux; y la segunda será sin utilizar el metodo <code>pipe</code>, simplemente tratando la salida del comando <code>cat</code>.</p>
<p>Como se nos pide que los datos necesarios sean pasados al programa desde la linesa de comandos utilizaremos el paquete <code>yargs</code>. </p>
<pre><code class="language-typescript"><span class="hl-2">yargs</span><span class="hl-1">.</span><span class="hl-5">command</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">command:</span><span class="hl-1"> </span><span class="hl-3">&#39;search&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">describe:</span><span class="hl-1"> </span><span class="hl-3">&#39;Buscador de palabras en ficheros&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">builder:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">path:</span><span class="hl-1"> { </span><br/><span class="hl-1">      </span><span class="hl-2">describe:</span><span class="hl-1"> </span><span class="hl-3">&#39;Nombre o ruta del fichero&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">demandOption:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-2">word:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">describe:</span><span class="hl-1"> </span><span class="hl-3">&#39;Palabra a buscar en el fichero&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">demandOption:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-2">pipe:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">describe:</span><span class="hl-1"> </span><span class="hl-3">&#39;Utilizar o no utilizar pipe&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">demandOption:</span><span class="hl-1"> </span><span class="hl-6">false</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;boolean&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">handler</span><span class="hl-1">(</span><span class="hl-2">argv</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">typeof</span><span class="hl-1"> </span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">path</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">typeof</span><span class="hl-1"> </span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">word</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">pipe</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-5">pipe</span><span class="hl-1">(</span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">path</span><span class="hl-1">, </span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">word</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">noPipe</span><span class="hl-1">(</span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">path</span><span class="hl-1">, </span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">word</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;ERROR: No se han especificado los parámetros correctamente&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">yargs</span><span class="hl-1">.</span><span class="hl-5">parse</span><span class="hl-1">();</span>
</code></pre>
<p>Podemos ver como se crean 3 opciones: <code>path</code> para la ruta del fichero, <code>word</code> como la palabra buscada en dicho fichero y <code>pipe</code> como un flag que si está activado utilizaremos el método <code>pipe</code> (llamando a la función <code>pipe()</code>) y por el contrario no lo utilizaremos (llamando a la función <code>noPipe()</code>). </p>
<p>La funcion <code>pipe()</code> recibe en sus parámetros la ruta del fichero y la palabra que se desea buscar.</p>
<pre><code class="language-typescript"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-5">pipe</span><span class="hl-1">(</span><span class="hl-2">path</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">, </span><span class="hl-2">word</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-5">existsSync</span><span class="hl-1">(</span><span class="hl-2">path</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">cat</span><span class="hl-1"> = </span><span class="hl-5">spawn</span><span class="hl-1">(</span><span class="hl-3">&#39;cat&#39;</span><span class="hl-1">, [</span><span class="hl-2">path</span><span class="hl-1">]);</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">grep</span><span class="hl-1"> = </span><span class="hl-5">spawn</span><span class="hl-1">(</span><span class="hl-3">&#39;grep&#39;</span><span class="hl-1">, [</span><span class="hl-3">&#39;-o&#39;</span><span class="hl-1">, </span><span class="hl-2">word</span><span class="hl-1">]);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">    </span><span class="hl-2">cat</span><span class="hl-1">.</span><span class="hl-2">stdout</span><span class="hl-1">.</span><span class="hl-5">pipe</span><span class="hl-1">(</span><span class="hl-2">grep</span><span class="hl-1">.</span><span class="hl-2">stdin</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-2">grep</span><span class="hl-1">.</span><span class="hl-2">stdout</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-2">data</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Se encontro </span><span class="hl-6">${</span><span class="hl-2">data</span><span class="hl-9">.</span><span class="hl-5">toString</span><span class="hl-9">().</span><span class="hl-5">split</span><span class="hl-9">(</span><span class="hl-3">&#39;</span><span class="hl-10">\n</span><span class="hl-3">&#39;</span><span class="hl-9">).</span><span class="hl-2">length</span><span class="hl-9"> </span><span class="hl-1">-</span><span class="hl-9"> </span><span class="hl-4">1</span><span class="hl-6">}</span><span class="hl-3"> veces la palabra </span><span class="hl-6">${</span><span class="hl-2">word</span><span class="hl-6">}</span><span class="hl-3"> en el archivo </span><span class="hl-6">${</span><span class="hl-2">path</span><span class="hl-6">}</span><span class="hl-3"> (método pipe)`</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;ERROR: No se encuentra el archivo especificado&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Como podemos observar utilizamos el método <code>spawn()</code> para crear procesos con los comandos deseados <code>cat</code> y <code>grep</code>, este último con la opción <code>-o</code> que imprime los resultados que coinciden con la expresión que le pasaremos a su lado (en nuestro caso la palabra buscada), es decir, si estuvieramos buscando la palabra &quot;hello&quot; el comando se vería de la siguiente forma: <code>grep -o hello</code></p>
<p>En el repositorio encontramos el archivo <code>helloworld.txt</code> con frases aleatorias:</p>
<pre><code><span class="hl-2">hello</span><span class="hl-1"> </span><span class="hl-2">world</span><span class="hl-1"> </span><span class="hl-2">hello</span><span class="hl-1"> </span><span class="hl-2">hello</span><br/><span class="hl-2">how</span><span class="hl-1"> </span><span class="hl-2">are</span><span class="hl-1"> </span><span class="hl-2">you</span><span class="hl-1"> </span><span class="hl-2">hello</span>
</code></pre>
<p>Al hacer el comando <code>grep -o hello</code> la salida quedaría de la siguiente forma:</p>
<pre><code><span class="hl-2">hello</span><br/><span class="hl-2">hello</span><br/><span class="hl-2">hello</span><br/><span class="hl-2">hello</span>
</code></pre>
<p>Por lo tanto para lograr el objetivo que tenemos en primer lugar vamos a redirigir la salida del comando <code>cat</code> al comando <code>grep</code>, cuando este detecte que tiene informacion con la que tratar procederemos a procesarla, convirtiendola en una string y aplicandole el método <code>split</code> para dividirla (utilizando como separador los espacios) y convertirla en un array al que podemos aplicarle el método <code>length</code> y ajustar su resultado.</p>
<p>Ahora veremos nuestra segunda estrategia sin utilizar el método <code>pipe</code>:</p>
<pre><code class="language-typescript"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-5">noPipe</span><span class="hl-1">(</span><span class="hl-2">path</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">, </span><span class="hl-2">word</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-5">existsSync</span><span class="hl-1">(</span><span class="hl-2">path</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">cat</span><span class="hl-1"> = </span><span class="hl-5">spawn</span><span class="hl-1">(</span><span class="hl-3">&#39;cat&#39;</span><span class="hl-1">, [</span><span class="hl-2">path</span><span class="hl-1">]);</span><br/><span class="hl-1">    </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">catOutput</span><span class="hl-1"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-2">cat</span><span class="hl-1">.</span><span class="hl-2">stdout</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-2">data</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">catOutput</span><span class="hl-1"> += </span><span class="hl-2">data</span><span class="hl-1">;</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">aux</span><span class="hl-1">: </span><span class="hl-8">number</span><span class="hl-1"> = </span><span class="hl-4">0</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">cat</span><span class="hl-1">.</span><span class="hl-2">stdout</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-3">&#39;close&#39;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">output_aux</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">[] = </span><span class="hl-2">catOutput</span><span class="hl-1">.</span><span class="hl-5">split</span><span class="hl-1">(</span><span class="hl-11">/\s/</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">output_aux</span><span class="hl-1">.</span><span class="hl-5">forEach</span><span class="hl-1">((</span><span class="hl-2">element</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">element</span><span class="hl-1"> == </span><span class="hl-2">word</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-2">aux</span><span class="hl-1">++;</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Se encontro </span><span class="hl-6">${</span><span class="hl-2">aux</span><span class="hl-6">}</span><span class="hl-3"> veces la palabra </span><span class="hl-6">${</span><span class="hl-2">word</span><span class="hl-6">}</span><span class="hl-3"> en el archivo </span><span class="hl-6">${</span><span class="hl-2">path</span><span class="hl-6">}</span><span class="hl-3"> (método no pipe)`</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;ERROR: No se encuentra el archivo especificado&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>En este caso solo trabajaremos con el comando <code>cat</code>, almacenaremos su salida en una variable auxiliar llamada <code>catOutput</code>. Cuando detectamos que el comando se ha terminado de ejecutarse comenzamos a buscar el término que deseamos, procesamos la salida <code>catOutput</code> haciendo un split y convirtiendola en un array con cada uno de los elementos (cada palabra, considerando el delimitador el espacio) obtenidos del comando <code>cat</code>. Recorreremos este array obtenido y compararemos cada una de sus posiciones con el término deseado, sumando un contador cada vez que tenemos una búsqueda exitosa y obteniendo así el número de ocurrencias.
<br></p>

<a href="#ejercicio-3-controlar-cambios-realizados-en-un-directorio-especificado" id="ejercicio-3-controlar-cambios-realizados-en-un-directorio-especificado" style="color: inherit; text-decoration: none;">
  <h3>Ejercicio 3: Controlar cambios realizados en un directorio especificado</h3>
</a>
<p><a href="https://github.com/ULL-ESIT-INF-DSI-2122/ull-esit-inf-dsi-21-22-prct10-async-fs-process-ccolivares/blob/main/src/ejercicio-3.ts">--&gt; Acceso al ejercicio 3 en Github</a></p>
<p>Se nos pide desarrollar un programa que reciba desde línea de comandos un nombre de un usuario y observe el directorio donde están almacenadas las notas de ese usuario esperando un cambio y se de información sobre el directorio en tiempo real. </p>
<p>En primer lugar para la opción de la línea de comandos utilizaremos el paquete <code>yargs</code>:</p>
<pre><code class="language-typescript"><span class="hl-2">yargs</span><span class="hl-1">.</span><span class="hl-5">command</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">command:</span><span class="hl-1"> </span><span class="hl-3">&#39;watch&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">describe:</span><span class="hl-1"> </span><span class="hl-3">&#39;Observa los archivos de un mismo usuario esperando un cambio&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">builder:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">user:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">describe:</span><span class="hl-1"> </span><span class="hl-3">&#39;Nombre de usuario&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">demandOption:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">handler</span><span class="hl-1">(</span><span class="hl-2">argv</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">typeof</span><span class="hl-1"> </span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">user</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-2">path</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> = </span><span class="hl-3">&#39;./database&#39;</span><span class="hl-1"> + </span><span class="hl-3">&#39;/&#39;</span><span class="hl-1"> + </span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">user</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-5">watch</span><span class="hl-1">(</span><span class="hl-2">path</span><span class="hl-1">, </span><span class="hl-2">argv</span><span class="hl-1">.</span><span class="hl-2">user</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">else</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;ERROR: Introducción de datos erronea&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">yargs</span><span class="hl-1">.</span><span class="hl-5">parse</span><span class="hl-1">();</span>
</code></pre>
<p>En este caso nuestro comando tiene una única opcion que es el parámetro obligatorio que representa al nombre del usuario (ya que nuestra biblioteca de notas se encuentra en la carpeta <code>/database</code> de la raíz y los usuarios son subdirectorios con sus correspondientes notas) y como podemos observar construimos una dirección a partir de ese usuario que se nos proporciona y el directorio <code>/database</code> y la almacenamos en una variable para llamar con ella y el nombre del usuario a nuestra función <code>watch()</code>.</p>
<p>la funcion <code>watch()</code> tiene como objetivo observar los cambios de un directorio:</p>
<pre><code class="language-typescript"><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-5">watch</span><span class="hl-1">(</span><span class="hl-2">path</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">, </span><span class="hl-2">user</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-5">readdir</span><span class="hl-1">(</span><span class="hl-2">path</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">, </span><span class="hl-2">prev_content</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;ERROR: No se ha podido leer el directorio&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&quot;Estoy observando...&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-5">watch</span><span class="hl-1">(</span><span class="hl-2">path</span><span class="hl-1">, (</span><span class="hl-2">eventType</span><span class="hl-1">, </span><span class="hl-2">filename</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Ha habido un cambio en el directorio de </span><span class="hl-6">${</span><span class="hl-2">user</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">eventType</span><span class="hl-1"> == </span><span class="hl-3">&quot;rename&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-2">fs</span><span class="hl-1">.</span><span class="hl-5">readdir</span><span class="hl-1">(</span><span class="hl-2">path</span><span class="hl-1">, (</span><span class="hl-2">err</span><span class="hl-1">, </span><span class="hl-2">curr_content</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">err</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">&#39;ERROR: No se ha podido leer el directorio&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">            } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">prev_content</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> &lt; </span><span class="hl-2">curr_content</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Se ha creado el archivo </span><span class="hl-6">${</span><span class="hl-2">filename</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">              } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Se ha eliminado el archivo </span><span class="hl-6">${</span><span class="hl-2">filename</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">              }</span><br/><span class="hl-1">              </span><span class="hl-2">prev_content</span><span class="hl-1"> = </span><span class="hl-2">curr_content</span><span class="hl-1">;</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">eventType</span><span class="hl-1"> == </span><span class="hl-3">&quot;change&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-3">`Se ha modificado el archivo </span><span class="hl-6">${</span><span class="hl-2">filename</span><span class="hl-6">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Para esta función tendremos en cuenta que debe observar cambios así que nos interesa el tamaño que tiene el directorio antes y despues de detectar un cambio, para poder obtener este dato utilizaremos el método <code>readdir()</code> que además nos ayudará a comprobar que se puede leer el directorio. El contenido del directorio se encuentra en la variable <code>prev_content</code> que utilizaremos más adelante.</p>
<p>Procedemos a utilizar el método <code>watch()</code> para observar los cambios en el directorio. En primer lugar nos interesa el evento <code>rename</code> pero este evento no nos informa concretamente de lo que necesitamos saber por lo tanto comprobaremos los tamaños de los contenidos del directorio antes y despues de recibir un evento de cambio. Volvemos a utilizar la función <code>readdir()</code> para obtener el tamaño del directorio y lo comparamos con el tamaño que teniamos anteriormente, si es mayor que el anterior significa que se ha creado un nuevo archivo, y en el caso contrario es que se ha eliminado. Y para finalizar actualizamos el contenido previo con el nuevo para futuras modificaciones en la misma ejecución.</p>
<p>Para el caso en el que simplemente se produce un cambio dentro de un archivo del directorio (es decir que el tamaño del directorio no cambia) utilizaremos el evento <code>change</code> para detectar modificaciones en archivos. </p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Modules</a></li><li class=" tsd-kind-module"><a href="modules/index.html">index</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>